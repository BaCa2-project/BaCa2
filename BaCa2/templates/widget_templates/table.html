{% load custom_tags %}

<div class="table-wrapper">

    <div class="table-widget-forms-wrapper">
        {% if table_widget.allow_delete %}
            <div class="table-widget-form delete-record-form"
                 data-table-id="{{ table_widget.name }}">
                {% with table_widget.delete_record_form_widget as form_widget %}
                    {% include 'widget_templates/forms/default.html' %}
                {% endwith %}
            </div>
        {% endif %}
    </div>

    <div class="card">

        {% if table_widget.display_util_header %}
            <div class="table-util-header card-body">
                <div class="row">
                    {% if table_widget.display_title %}
                        <div class="col-auto">
                            <h4 class="table-title ms-3">{{ table_widget.title }}</h4>
                        </div>
                    {% endif %}
                    <div class="col">
                        <div class="row justify-content-end">
                            {% if table_widget.allow_global_search %}
                                <div class="col-auto d-flex align-items-center">
                                    <div class="table-search">
                                    </div>
                                </div>
                            {% endif %}
                            {% if table_widget.table_buttons %}
                                <div class="col-auto">
                                    <div class="table-buttons row justify-content-end">
                                        {% if table_widget.refresh_button %}
                                            <div class="table-btn-wrapper col-auto">
                                                <button class="table-refresh-btn btn
                                                           btn-outline-light_muted"
                                                        type="button"
                                                        data-refresh-target="{{ table_widget.name }}">
                                                    <small>
                                                        <i class="bi bi-arrow-clockwise"></i>
                                                    </small>
                                                </button>
                                            </div>
                                        {% endif %}
                                        {% if table_widget.delete_button %}
                                            <div class="table-btn-wrapper col-auto">
                                                <button class="btn btn-outline-danger"
                                                        type="button">
                                                    <small>
                                                        <i class="bi bi-trash3"></i>
                                                    </small>
                                                </button>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <hr class="m-0">
        {% endif %}

        <div class="card-body">
            <div class="table-responsive" data-paging="{{ table_widget.paging }}">
                <table class="{{ table_widget.widget_class }}"
                       id="{{ table_widget.name }}"
                       data-deselect-on-filter="{{ table_widget.deselect_on_filter }}"
                       style="width:100%">
                    <thead>
                    <tr>
                        {% for col in table_widget.cols %}
                            <th class="{{ col.col_type }}
                                               {% if col.sortable == "true" %}
                                               pe-5
                                               {% endif %}"
                                data-searchable="{{ col.searchable }}"
                                data-sortable="{{ col.sortable }}">
                                {% if col.searchable == "true" and table_widget.allow_column_search %}
                                    <input type="text"
                                           class="column-search form-control"
                                           placeholder="{{ col.header }}">
                                {% else %}
                                    {{ col.header }}
                                {% endif %}
                            </th>
                        {% endfor %}
                    </tr>
                    </thead>
                </table>
            </div>
        </div>

    </div>
</div>


<script type="text/javascript">
    initTable({
                  tableId: '{{ table_widget.name }}',
                  ajax: {{ table_widget.ajax|safe }},
                  dataSourceUrl: '{{ table_widget.data_source_url|safe }}',
                  dataSource: {{ table_widget.data_source|safe }},
                  cols: {{ table_widget.cols|safe }},
                  defaultOrder: '{{ table_widget.default_order }}',
                  defaultOrderCol: parseInt({{ table_widget.default_order_col }}),
                  searching: {{ table_widget.allow_global_search|safe }},
                  paging: {{ table_widget.paging|safe }},
                  refresh: {{ table_widget.refresh|safe }},
                  refreshInterval: parseInt({{ table_widget.refresh_interval }}),
                  linkFormatString: '{{ table_widget.link_format_string|safe }}',
              });
</script>
